{"version":3,"sources":["../../../app/assets/scripts/service.js"],"names":["app","service","$http","$q","self","userid","unid","photo","isLogin","getLoginResult","d","defer","jsonp","success","res","console","log","ResultCode","Code","UserInfo","UNID","UserID","PIPath","resolve","error","reject","promise","LoginService","serverTime","missions","missionCompleted","isJoin","isJoinPopup","getServerTime","method","url","params","cm","ServerTime","setJoinCountry","code","countrycode","then","successCallback","location","reload","errorCallback","response","getEventUserEvent","userData","UserData","length","Playtime","playTime"],"mappings":"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","file":"service.js","sourcesContent":["app.service('LoginService', function($http, $q) {\n\tvar self = {\n\t\tuserid: null,\n\t\tunid: null,\n\t\tphoto: null,\n\t\tisLogin: false,\n\t\tgetLoginResult: function() {\n\t\t\tvar d = $q.defer();\n\t\t\t$http.jsonp('http://io.papayaplay.com/auth/user.do?callback=JSON_CALLBACK')\n\t\t\t.success(function (res) {\n\t\t\t\tconsole.log(\"loginService\",res);\n\t\t\t\tif (res.ResultCode[0].Code == 10000) {\n\t\t\t\t\tself.unid = res.UserInfo[0].UNID;\n\t\t\t\t\tself.userid = res.UserInfo[0].UserID;\n\t\t\t\t\tself.photo = res.UserInfo[0].PIPath;\n\t\t\t\t\tself.isLogin = true;\n\t\t\t\t\td.resolve(res);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.error(function () {\n\t\t\t\tself.isLogin = false;\n\t\t\t\td.reject(res);\n\t\t\t});\n\t\t\treturn d.promise;\n\t\t}\n\t};\n\tself.getLoginResult();\n\treturn self;\n});\n\napp.service('EventService', function($http, $q, LoginService) {\n\tvar self = {\n\t\tserverTime: null,\n\t\tmissions: [],\n\t\tmissionCompleted: 0,\n\t\tisJoin:false,\n\t\tisJoinPopup:false,\n\t\tgetServerTime: function () {\n\t\t\tvar d = $q.defer();\n\t\t\t$http({\n\t\t\t\tmethod: 'jsonp',\n\t\t\t\turl: 'http://io.papayaplay.com/json.do?callback=JSON_CALLBACK',\n\t\t\t\tparams: { cm: 'Service.Board.GetServerTime' }\n\t\t\t})\n\t\t\t.success(function(res) {\n\t\t\t\tconsole.log(\"servertime\",res);\n\t\t\t\tif (res.ResultCode[0].Code == 10000) {\n\t\t\t\t\tself.serverTime = res.ServerTime[0].ServerTime;\n\t\t\t\t\td.resolve(self.serverTime);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.error(function () {\n\t\t\t\td.reject(res);\n\t\t\t});\n\n\t\t\treturn d.promise;\n\t\t},\n\n\t\tsetJoinCountry:function(unid, code) {\n\t\t\t$http({\n\t\t\t\tmethod: 'jsonp',\n\t\t\t\turl: 'http://io.sea.papayaplay.com/secured/json.do?callback=JSON_CALLBACK',\n\t\t\t\tparams : { cm: 'Service.Event.SetUser_BSSEACS80', unid: unid, countrycode: code },\n\t\t\t}).then(function successCallback(res) {\n\t\t\t\tconsole.log(res);\n\t\t\t\tlocation.reload();\n\t\t\t}, function errorCallback(response) {\n\t\t\t\tconsole.log('error');\n\t\t\t});\n\t\t},\n\t\tgetEventUserEvent:function(unid){\n\t\t\tvar d = $q.defer();\n\t\t\t$http({\n\t\t\t\tmethod: 'jsonp',\n\t\t\t\turl: 'http://io.sea.papayaplay.com/json.do?callback=JSON_CALLBACK',\n\t\t\t\tparams : { cm: 'Service.Event.GetEventResult_BSSEACS80', unid: unid },\n\t\t\t})\n\t\t\t.success(function(res) {\n\t\t\t\tconsole.log(\"user\", res);\n\t\t\t\tself.userData = res;\n\t\t\t\tif (res.UserData.length === 0 || res.UserData[0].Playtime === 0) {\n\t\t\t\t\tself.playTime = 3600;\n\t\t\t\t} else {\n\t\t\t\t\tself.playTime = 3600 - res.UserData[0].Playtime;\n\t\t\t\t}\n\t\t\t\td.resolve(self.userData);\n\t\t\t\tconsole.log(\"self.userData \", self.userData );\n\t\t\t})\n\t\t\t.error(function() {\n\t\t\t\td.reject(res);\n\t\t\t});\n\t\t\treturn d.promise;\n\t\t}\n\t};\n\n\tself.getServerTime().then(function () {\n\t\tself.getEventUserEvent(LoginService.unid);\n\t});\n\n\treturn self;\n});\n\n\n"]}